<!DOCTYPE html>
<html>
	<head>
		<title>Three.js Navigation</title>
	
	</head>
	<body style="font-family: Tahoma; line-height:90%">
        <meta charset="utf-8">
			<div id="title" style="text-align: center;"><h1>Three.js Face Selection Demo</h1></div>
				
            <div id="screen" style="margin: 0px auto;"></div>
			<select id = "group-drop-down" style="position: absolute; z-index: 1; left: 100px; top: 100px;"></select>
				
			<br />
			<div style="text-align: center;">
				<div><b>Select (De-select) Face/Object:</b>&nbsp;&nbsp;&nbsp;Left mouse button (After object has been selected)</div>
				<br />
				<div><b>Select Multiple Faces:</b>&nbsp;&nbsp;&nbsp;SHIFT + Left mouse button (After object has been selected)</div>
				<br />
				<div><b>Rotate Camera:</b>&nbsp;&nbsp;&nbsp;Middle mouse button</div>
				<br />
				<div><b>Translate Camera:</b>&nbsp;&nbsp;&nbsp;SHIFT + Middle mouse button</div>
				<br />
				<div><b>Zoom Camera:</b>&nbsp;&nbsp;&nbsp;Scroll wheel</div>
				<br />
			</div>  
			
        <!--<script type="text/javascript" src="./three.js/build/three.js"></script>-->
		<script type="text/javascript" src="./js/three.js"></script>
        <script type="text/javascript" src="./js/controls/orbit.js"></script>
        <script type="text/javascript" src="./js/controls/grabber.js"></script>
		<script type="text/javascript" src="./js/controls/hud.js"></script>
		<script type="text/javascript" src="./js/controls/faceSelector.js"></script>
		<script type="text/javascript" src="./js/controls/boundingBox.js"></script>
        <script type="text/javascript" src="./js/Detector.js"></script>
		
        <script type="text/javascript">
		
			function generateHud () {
			
				////////////////////////////////////////////////////////////////////////////////////////////
				//All of the material stuff below will be moved elsewhere later for the sake of cleanliness
				////////////////////////////////////////////////////////////////////////////////////////////
				
				var texture = THREE.ImageUtils.loadTexture( './images/eyedropper.png' );
				var front = THREE.ImageUtils.loadTexture( './images/Front.png' );
				var back = THREE.ImageUtils.loadTexture( './images/Back.png' );
				var left = THREE.ImageUtils.loadTexture( './images/Left.png' );
				var right = THREE.ImageUtils.loadTexture( './images/Right.png' );
				var top = THREE.ImageUtils.loadTexture( './images/Top.png' );
				var bottom = THREE.ImageUtils.loadTexture( './images/Bottom.png' );
				
				var useObjects = THREE.ImageUtils.loadTexture( './images/Objects.png' );
				var useFaces = THREE.ImageUtils.loadTexture( './images/Faces.png' );
				var createGroup = THREE.ImageUtils.loadTexture( './images/createGroup.png' );
				//1378288696_eyedropper.png
				
				console.log( right );
				
				var faceMat = new THREE.MeshBasicMaterial( { color: 0xff0000, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: useObjects } );
				var objectMat = new THREE.MeshBasicMaterial( { color: 0xff0000, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: useFaces } );
				
				var white = new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: texture } );
				
				var leftMat = new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: left } );
				var rightMat = new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: right } );

				var topMat = new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: top } );
				var bottomMat = new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: bottom } );
				
				var frontMat = new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: front } );
				var backMat = new THREE.MeshBasicMaterial( { color: 0xffffff, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: back } );
				
				var yellow = new THREE.MeshBasicMaterial( { color: 0xffff00, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true } );
				var groupMat = new THREE.MeshBasicMaterial( { color: 0x00ff00, side: THREE.DoubleSide, depthTest: false, depthWrite: false, transparent: true, map: createGroup } );
				
				var obs = [
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), faceMat ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), objectMat ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), yellow ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), leftMat ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), rightMat ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), topMat ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), bottomMat ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), frontMat ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), backMat ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), white ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), groupMat ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), yellow ),
					new THREE.Mesh( new THREE.PlaneGeometry( 1, 1 ), yellow )
				];
				
				obs[ 0 ].name = 'select-objects';
				obs[ 1 ].name = 'select-faces';
				obs[ 2 ].name = 'select-all';
				
				obs[ 3 ].name = 'left';
				obs[ 4 ].name = 'right';
				obs[ 5 ].name = 'top';
				obs[ 6 ].name = 'bottom';
				obs[ 7 ].name = 'front';
				obs[ 8 ].name = 'back';
				
				obs[ 9 ].name = 'color-picker';
				obs[ 10 ].name = 'create-group';
				obs[ 11 ].name = 'hide-faces';
				obs[ 12 ].name = 'select-all-in-group';
				
				return obs;
			}
		
            function init( webglFlag ) {
				
				var screen = document.getElementById( 'screen' );
				screen.style.width = window.innerWidth / 2 - 40 + "px";
				screen.style.height = ( 3 / 5 ) * eval( screen.style.width.slice( 0, -2 ) ) + "px";
				
				var groupDropDown = document.getElementById( 'group-drop-down' );
				groupDropDown.style.left = screen.offsetLeft + 10 + 'px';
				groupDropDown.style.top = screen.offsetTop + 10 + 'px';
				
				window.onresize = function () {
				
					groupDropDown.style.left = screen.offsetLeft + 10 + 'px';
					groupDropDown.style.top = screen.offsetTop + 10 + 'px';
				
				}
				
				var scene = new THREE.Scene();
				var camera = new THREE.PerspectiveCamera();
				camera.position.z = 8;
				scene.add( camera );

				//Viewport handles scaling from browser window coordinates to three.js coordinates.
				camera.viewportConfig( 5, 3, camera.position.z, scene, screen );
				camera.addHud( generateHud() );
				camera.createAxisVis();
				var scales = camera.getViewScales();

				//CamOrbit handles all navigation. It acts like a pivot point around which the user can move.
				var camOrbit = new THREE.orbitControls( camera, scales.width, scales.height, scene, screen );
	 
				//  RENDERER
				webglFlag = typeof webglFlag !== 'undefined' ? webglFlag : false;
				var renderer;
				if (webglFlag) {
					renderer = new THREE.WebGLRenderer();
				} else {
					renderer = new THREE.CanvasRenderer();
				}
				
				renderer.setSize( eval( screen.style.width.slice( 0, -2) ), eval( screen.style.height.slice( 0, -2 ) ) );
				screen.appendChild( renderer.domElement );
				renderer.setClearColor ( new THREE.Color(0x444444), 1 );
				//  END RENDERER
				
				//  cube
				var cube = new THREE.Mesh( new THREE.CubeGeometry( 1, 1, 1 ), new THREE.MeshLambertMaterial( { color: 0xFF0000 } ) );
				cube.geometry.colorsNeedUpdate = true;
				
				var cubeMatList = [];

				for ( var i = 0 ; i < cube.geometry.faces.length ; i++ ) {
					
					cubeMatList[ i ] = ( new THREE.MeshLambertMaterial( { color: 0xffffff, shading: THREE.FlatShading, vertexColors: THREE.FaceColors, visible: true, side: THREE.DoubleSide } ) );
					
				}

				cube.material = new THREE.MeshFaceMaterial( cubeMatList );
				
				for ( var i = 0 ; i < cubeMatList.length ; i++ ) {
				
					cube.geometry.faces[ i ].materialIndex = i;
					cube.geometry.colorsNeedUpdate = true;
				
				}
				
				cube.name = "cube";
				cube.rotation.set( Math.PI / 4, Math.PI / 4, 0 );
				cube.position.set( 2, 0, 0 );
				scene.add(cube);
				
				//  cylinder
				var cylinder = new THREE.Mesh( new THREE.CylinderGeometry( 1, 1, 2, 8, 1, false ), new THREE.MeshLambertMaterial( { color: 0xFFFF00, shading: THREE.FlatShading } ) );
				cylinder.geometry.colorsNeedUpdate = true;
				
				var cylMatList = [];

				for ( var i = 0 ; i < cylinder.geometry.faces.length ; i++ ) {
					
					cylMatList[ i ] = ( new THREE.MeshLambertMaterial( { color: 0xffffff, shading: THREE.FlatShading, vertexColors: THREE.FaceColors, visible: true, side: THREE.DoubleSide } ) );
					
				}

				cylinder.material = new THREE.MeshFaceMaterial( cylMatList );
				
				for ( var i = 0 ; i < cylMatList.length ; i++ ) {
				
					cylinder.geometry.faces[ i ].materialIndex = i;
					cylinder.geometry.colorsNeedUpdate = true;
				
				}
				
				cylinder.name = "cylinder";
				cylinder.rotation.set( 0, Math.PI / 4, Math.PI / 4 );
				cylinder.position.set( 0, -2, -4 );
				scene.add( cylinder );
				
				
				var sphere = new THREE.Mesh( new THREE.OctahedronGeometry( 1, 1 ) );
				sphere.geometry.colorsNeedUpdate = true;
				
				var sphereMatList = [];

				for ( var i = 0 ; i < sphere.geometry.faces.length ; i++ ) {
					
					sphereMatList[ i ] = ( new THREE.MeshLambertMaterial( { color: 0xffffff, shading: THREE.FlatShading, vertexColors: THREE.FaceColors, visible: true, side: THREE.DoubleSide } ) );
					
				}

				sphere.material = new THREE.MeshFaceMaterial( sphereMatList );
				
				for ( var i = 0 ; i < sphereMatList.length ; i++ ) {
				
					sphere.geometry.faces[ i ].materialIndex = i;
					sphere.geometry.colorsNeedUpdate = true;
				
				}
				
				sphere.name = "sphere";
				sphere.position.set( -1, 1, 1 );
				scene.add( sphere );
				
				//  Plane
				var plane = new THREE.Mesh( new THREE.PlaneGeometry(20, 20, 8, 8), new THREE.MeshLambertMaterial( { color: 0x777777, shading: THREE.FlatShading } ) );
				plane.name = "plane";
				plane.rotation.set( - Math.PI / 2, 0, 0 );
				plane.position.set( 0, - 3.5, 0 );
				scene.add( plane );
				
				//Lights!!
				var light = new THREE.DirectionalLight( 0x404040, 5, 100 );
				light.position.set( 5, 5, 10 );
				scene.add( light );
				light.target = plane;
				
				var grabCube = new THREE.faceSelector( scene, camera, scales.width, scales.height, screen );
				grabCube.addObject( [ cube, sphere, cylinder ] );
				grabCube.setInitialGroups();
				
				document.addEventListener( 'keydown', function ( event ) {
				
					if ( event.keyCode === 81 ) {
					
						grabCube.useBoundingBox( false );
					
					} else if ( event.keyCode == 87 ) {
					
						grabCube.useBoundingBox( true );
					
					}
				
				}, false );
				
				function render() {

					camOrbit.update();

					requestAnimationFrame(render);
					renderer.render(scene, camera);
										
				}
				
				render();
            
            }

            if (Detector.webgl) {
                init( true );
            } else {
                init();
            }       
			
        </script>
	</body>
</html>